axis.line=element_line(size=0.5, colour="black",
linetype="solid"),
axis.title.x=element_text(size=14),
axis.text.x  = element_text(angle=90,size=12, hjust=1,
vjust=0),
axis.text.y  = element_text(size=12),
axis.line.x = element_line(color="black", size = 0.5),
axis.line.y = element_line(color="black", size = 0.5),
axis.title.y = element_text(size=14)) +
geom_hline(aes(yintercept=20), linetype="dashed",
color="#0072B2") +
geom_hline(aes(yintercept=40), linetype="dashed",
color="#56B4E9") +
geom_hline(aes(yintercept=60), linetype="dashed",
color="#009E73") +
geom_hline(aes(yintercept=80), linetype="dashed",
color="#E69F00")
return(graph_base)
}
#boxplot if 1 location
for (i in seq_len(n_pages2)){
print(ggplot(df, aes(x=Spp, y=percentile))+ #add lines first
geom_hline(aes(yintercept=0), linetype="dashed", color="#000000") +
geom_hline(aes(yintercept=20), linetype="dashed", color="#0072B2") +
geom_hline(aes(yintercept=40), linetype="dashed", color="#56B4E9") +
geom_hline(aes(yintercept=60), linetype="dashed", color="#009E73") +
geom_hline(aes(yintercept=80), linetype="dashed", color="#E69F00") +
geom_boxplot(df, mapping = aes(fill=species))+
xlab("\nSpecies")+
ylab("Bat Activity Level (Percentile)\n")+
scale_fill_grey(start = 0.35, end = 1)+
scale_x_discrete(drop=FALSE) +
scale_y_continuous(breaks=seq(0,100,20)) +
expand_limits(y=c(0,100))+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(linetype="blank"),
axis.line=element_line(size=0.5, colour="black",
linetype="solid"),
axis.title.x=element_text(size=18),
axis.text.x  = element_text(angle=90, face="italic",
size=10, hjust=1, vjust=0),
axis.text.y  = element_text(size=12),
axis.line.x = element_line(color="black", size = 0.5),
axis.line.y = element_line(color="black", size = 0.5),
axis.title.y=element_text(size=16),
legend.position="none") +
facet_grid_paginate(species ~ ., ncol=1, nrow=4,
scales="fixed", page=i) +
theme(strip.text.y = element_text(size=12, face="italic")))
}
#boxplot if 1 location
for (i in seq_len(n_pages2)){
print(ggplot(df, aes(x=Spp, y=percentile))+ #add lines first
geom_hline(aes(yintercept=0), linetype="dashed", color="#000000") +
geom_hline(aes(yintercept=20), linetype="dashed", color="#0072B2") +
geom_hline(aes(yintercept=40), linetype="dashed", color="#56B4E9") +
geom_hline(aes(yintercept=60), linetype="dashed", color="#009E73") +
geom_hline(aes(yintercept=80), linetype="dashed", color="#E69F00") +
geom_boxplot(df, mapping = aes(fill=species))+
xlab("\nSpecies")+
ylab("Bat Activity Level (Percentile)\n")+
scale_fill_grey(start = 0.35, end = 1)+
scale_x_discrete(drop=FALSE) +
scale_y_continuous(breaks=seq(0,100,20)) +
expand_limits(y=c(0,100))+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(colour="black",
linetype="solid"),
axis.line=element_line(size=0.5, colour="black",
linetype="solid"),
axis.title.x=element_text(size=18),
axis.text.x  = element_text(angle=90, face="italic",
size=10, hjust=1, vjust=0),
axis.text.y  = element_text(size=12),
axis.line.x = element_line(color="black", size = 0.5),
axis.line.y = element_line(color="black", size = 0.5),
axis.title.y=element_text(size=16),
legend.position="none") +
facet_grid_paginate(species ~ ., ncol=1, nrow=4,
scales="fixed", page=i) +
theme(strip.text.y = element_text(size=12, face="italic")))
}
#boxplot if 1 location
for (i in seq_len(n_pages2)){
print(ggplot(df, aes(x=Spp, y=percentile))+ #add lines first
geom_hline(aes(yintercept=0), linetype="dashed", color="#000000") +
geom_hline(aes(yintercept=20), linetype="dashed", color="#0072B2") +
geom_hline(aes(yintercept=40), linetype="dashed", color="#56B4E9") +
geom_hline(aes(yintercept=60), linetype="dashed", color="#009E73") +
geom_hline(aes(yintercept=80), linetype="dashed", color="#E69F00") +
geom_boxplot(df, mapping = aes(fill=species))+
xlab("\nSpecies")+
ylab("Bat Activity Level (Percentile)\n")+
scale_fill_grey(start = 0.35, end = 1)+
scale_x_discrete(drop=TRUE) +
scale_y_continuous(breaks=seq(0,100,20)) +
expand_limits(y=c(0,100))+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(colour="black",
linetype="solid"),
axis.line=element_line(size=0.5, colour="black",
linetype="solid"),
axis.title.x=element_text(size=18),
axis.text.x  = element_text(angle=90, face="italic",
size=10, hjust=1, vjust=0),
axis.text.y  = element_text(size=12),
axis.line.x = element_line(color="black", size = 0.5),
axis.line.y = element_line(color="black", size = 0.5),
axis.title.y=element_text(size=16),
legend.position="none") +
facet_grid_paginate(species ~ ., ncol=1, nrow=4,
scales="fixed", page=i) +
theme(strip.text.y = element_text(size=12, face="italic")))
}
#boxplot if 1 location
graphbox<-ggplot(df, aes(x=Spp, y=percentile))+ #add lines first
geom_hline(aes(yintercept=0), linetype="dashed", color="#000000") +
geom_hline(aes(yintercept=20), linetype="dashed", color="#0072B2") +
geom_hline(aes(yintercept=40), linetype="dashed", color="#56B4E9") +
geom_hline(aes(yintercept=60), linetype="dashed", color="#009E73") +
geom_hline(aes(yintercept=80), linetype="dashed", color="#E69F00") +
geom_boxplot(df, mapping = aes(fill=species))+
xlab("\nSpecies")+
ylab("Bat Activity Level (Percentile)\n")+
scale_fill_grey(start = 0.35, end = 1)+
scale_x_discrete(drop=TRUE) +
scale_y_continuous(breaks=seq(0,100,20)) +
expand_limits(y=c(0,100))+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(linetype="blank"),
axis.line=element_line(size=0.5, colour="black", linetype="solid"),
axis.title.x=element_text(size=18),
axis.text.x  = element_text(angle=90, face="italic", size=14, hjust=1, vjust=0),
axis.text.y  = element_text(size=12),
axis.line.x = element_line(color="black", size = 0.5),
axis.line.y = element_line(color="black", size = 0.5),
axis.title.y=element_text(size=16),
legend.position="none")
graphbox
df$percentiles <- as.numeric(df$percentile)
medians <- df %>%
dplyr::select(location_name, Night, Spp, percentiles,
activity_level, species) %>%
dplyr::group_by(Night, Spp) %>%
dplyr::mutate(med = median(percentiles)) %>%
dplyr::arrange(Night)
## baseplot for medians across all detectors
median_baseplot <- function (df, breaks) {
graph_medians <- ggplot(medians, aes(x = Night,
y = (median(med)))) +
geom_point(medians, size=3, shape=1,
mapping = aes(x=Night, y= med,
color=activity_level))+
ylab("Median Bat Activity Level")+
scale_colour_manual(values=cbbPalette, name="Activity\nLevel",
breaks=c("High","Moderate/High","Moderate",
"Low/Moderate","Low"))+
scale_y_continuous(breaks=seq(0,100,20), limits=c(0,100)) +
scale_x_date(name = "Date", date_breaks = breaks,
date_labels = "%d %b %Y")+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(colour="black",
linetype="solid"),
axis.line=element_line(size=0.5, colour="black",
linetype="solid"),
axis.title.x=element_text(size=18),
axis.text.x  = element_text(angle=90,size=16,
hjust=1, vjust=0),
axis.text.y  = element_text(size=12),
axis.line.x = element_line(color="black", size = 0.5),
axis.line.y = element_line(color="black", size = 0.5),
axis.title.y=element_text(size=18)) +
geom_hline(aes(yintercept=20), linetype="dashed",
color="#0072B2") +
geom_hline(aes(yintercept=40), linetype="dashed",
color="#56B4E9") +
geom_hline(aes(yintercept=60), linetype="dashed",
color="#009E73") +
geom_hline(aes(yintercept=80), linetype="dashed",
color="#E69F00")
return(graph_medians)
}
## baseplot for medians across all detectors
median_baseplot <- function (df, breaks) {
graph_medians <- ggplot(medians, aes(x = Night,
y = (median(med)))) +
geom_point(medians, size=3, shape=1,
mapping = aes(x=Night, y= med,
color=activity_level))+
ylab("Median Bat Activity Level")+
scale_colour_manual(values=cbbPalette, name="Activity\nLevel",
breaks=c("High","Moderate/High","Moderate",
"Low/Moderate","Low"))+
scale_y_continuous(breaks=seq(0,100,20), limits=c(0,100)) +
scale_x_date(name = "Date", date_breaks = breaks,
date_labels = "%d %b %Y")+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(colour="black",
linetype="solid"),
axis.line=element_line(size=0.5, colour="black",
linetype="solid"),
axis.title.x=element_text(size=14),
axis.text.x  = element_text(angle=90,size=12,
hjust=1, vjust=0),
axis.text.y  = element_text(size=12),
axis.line.x = element_line(color="black", size = 0.5),
axis.line.y = element_line(color="black", size = 0.5),
axis.title.y=element_text(size=14)) +
geom_hline(aes(yintercept=20), linetype="dashed",
color="#0072B2") +
geom_hline(aes(yintercept=40), linetype="dashed",
color="#56B4E9") +
geom_hline(aes(yintercept=60), linetype="dashed",
color="#009E73") +
geom_hline(aes(yintercept=80), linetype="dashed",
color="#E69F00")
return(graph_medians)
}
#boxplot if 1 location
graphbox<-ggplot(df, aes(x=Spp, y=percentile)) +
geom_hline(aes(yintercept=0), linetype="dashed", color="#000000") +
geom_hline(aes(yintercept=20), linetype="dashed", color="#0072B2") +
geom_hline(aes(yintercept=40), linetype="dashed", color="#56B4E9") +
geom_hline(aes(yintercept=60), linetype="dashed", color="#009E73") +
geom_hline(aes(yintercept=80), linetype="dashed", color="#E69F00") +
geom_boxplot(df, mapping = aes(fill=species))+
xlab("Species")+
ylab("Bat Activity Level (Percentile)")+
scale_fill_grey(start = 0.35, end = 1)+
scale_x_discrete(drop=TRUE) +
scale_y_continuous(breaks=seq(0,100,20)) +
expand_limits(y=c(0,100))+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(linetype="blank"),
axis.line=element_line(size=0.5, colour="black", linetype="solid"),
axis.title.x=element_text(size=18),
axis.text.x  = element_text(angle=90, face="italic", size=14, hjust=1, vjust=0),
axis.text.y  = element_text(size=12),
axis.line.x = element_line(color="black", size = 0.5),
axis.line.y = element_line(color="black", size = 0.5),
axis.title.y=element_text(size=16),
legend.position="none") +
facet_wrap(~Month, ncol=2)
graphbox
#boxplot if 1 location
for (i in seq_len(n_pages2)){
print(ggplot(df, aes(x=Spp, y=percentile)) +
geom_hline(aes(yintercept=0), linetype="dashed", color="#000000") +
geom_hline(aes(yintercept=20), linetype="dashed", color="#0072B2") +
geom_hline(aes(yintercept=40), linetype="dashed", color="#56B4E9") +
geom_hline(aes(yintercept=60), linetype="dashed", color="#009E73") +
geom_hline(aes(yintercept=80), linetype="dashed", color="#E69F00") +
geom_boxplot(df, mapping = aes(fill=species))+
xlab("\nSpecies")+
ylab("Bat Activity Level (Percentile)\n")+
scale_fill_grey(start = 0.35, end = 1)+
scale_x_discrete(drop=TRUE) +
scale_y_continuous(breaks=seq(0,100,20)) +
expand_limits(y=c(0,100))+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(colour="black",
linetype="solid"),
axis.line=element_line(size=0.5, colour="black",
linetype="solid"),
axis.title.x=element_text(size=18),
axis.text.x  = element_text(angle=90, face="italic",
size=10, hjust=1, vjust=0),
axis.text.y  = element_text(size=12),
axis.line.x = element_line(color="black", size = 0.5),
axis.line.y = element_line(color="black", size = 0.5),
axis.title.y=element_text(size=16),
legend.position="none") +
facet_grid_paginate(species ~ ., ncol=1, nrow=4,
scales="fixed", page=i) +
theme(strip.text.y = element_text(size=12, face="italic")))
}
#boxplot if 1 location
for (i in seq_len(n_pages2)){
print(ggplot(df, aes(x=Spp, y=percentile))+ #add lines first
geom_hline(aes(yintercept=0), linetype="dashed", color="#000000") +
geom_hline(aes(yintercept=20), linetype="dashed", color="#0072B2") +
geom_hline(aes(yintercept=40), linetype="dashed", color="#56B4E9") +
geom_hline(aes(yintercept=60), linetype="dashed", color="#009E73") +
geom_hline(aes(yintercept=80), linetype="dashed", color="#E69F00") +
geom_boxplot(df, mapping = aes(fill=species))+
xlab("\nSpecies")+
ylab("Bat Activity Level (Percentile)\n")+
scale_fill_grey(start = 0.35, end = 1)+
scale_x_discrete(drop=TRUE) +
scale_y_continuous(breaks=seq(0,100,20)) +
expand_limits(y=c(0,100))+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(colour="black",
linetype="solid"),
axis.line=element_line(size=0.5, colour="black",
linetype="solid"),
axis.title.x=element_text(size=18),
axis.text.x  = element_text(angle=90, face="italic",
size=10, hjust=1, vjust=0),
axis.text.y  = element_text(size=12),
axis.line.x = element_line(color="black", size = 0.5),
axis.line.y = element_line(color="black", size = 0.5),
axis.title.y=element_text(size=16),
legend.position="none") +
facet_grid_paginate(species ~ ., ncol=1, nrow=4,
scales="fixed", page=i) +
theme(strip.text.y = element_text(size=12, face="italic")))
}
#boxplot if 1 location
graphbox<-ggplot(df, aes(x=Spp, y=percentile))+ #add lines first
geom_hline(aes(yintercept=0), linetype="dashed", color="#000000") +
geom_hline(aes(yintercept=20), linetype="dashed", color="#0072B2") +
geom_hline(aes(yintercept=40), linetype="dashed", color="#56B4E9") +
geom_hline(aes(yintercept=60), linetype="dashed", color="#009E73") +
geom_hline(aes(yintercept=80), linetype="dashed", color="#E69F00") +
geom_boxplot(df, mapping = aes(fill=species))+
xlab("\nSpecies")+
ylab("Bat Activity Level (Percentile)\n")+
scale_fill_grey(start = 0.35, end = 1)+
scale_x_discrete(drop=TRUE) +
scale_y_continuous(breaks=seq(0,100,20)) +
expand_limits(y=c(0,100))+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(linetype="blank"),
axis.line=element_line(size=0.5, colour="black", linetype="solid"),
axis.title.x=element_text(size=18),
axis.text.x  = element_text(angle=90, face="italic", size=14, hjust=1, vjust=0),
axis.text.y  = element_text(size=12),
axis.line.x = element_line(color="black", size = 0.5),
axis.line.y = element_line(color="black", size = 0.5),
axis.title.y=element_text(size=16),
legend.position="none")
graphbox
#boxplot if 1 location
for (i in seq_len(n_pages2)){
print(ggplot(df, aes(x=Spp, y=percentile))+ #add lines first
geom_hline(aes(yintercept=0), linetype="dashed", color="#000000") +
geom_hline(aes(yintercept=20), linetype="dashed", color="#0072B2") +
geom_hline(aes(yintercept=40), linetype="dashed", color="#56B4E9") +
geom_hline(aes(yintercept=60), linetype="dashed", color="#009E73") +
geom_hline(aes(yintercept=80), linetype="dashed", color="#E69F00") +
geom_boxplot(df, mapping = aes(fill=species))+
xlab("\nSpecies")+
ylab("Bat Activity Level (Percentile)\n")+
scale_fill_grey(start = 0.35, end = 1)+
scale_x_discrete(drop=TRUE) +
scale_y_continuous(breaks=seq(0,100,20)) +
expand_limits(y=c(0,100))+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(colour="black",
linetype="solid"),
axis.line=element_line(size=0.5, colour="black",
linetype="solid"),
axis.title.x=element_text(size=18),
axis.text.x  = element_text(angle=90, face="italic",
size=10, hjust=1, vjust=0),
axis.text.y  = element_text(size=12),
axis.line.x = element_line(color="black", size = 0.5),
axis.line.y = element_line(color="black", size = 0.5),
axis.title.y=element_text(size=16),
legend.position="none") +
facet_grid_paginate(species ~ ., ncol=1, nrow=4,
scales="fixed", page=i) +
theme(strip.text.y = element_text(size=12, face="italic")))
}
View(df)
#boxplot if 1 location
for (i in seq_len(n_pages2)){
print(ggplot(df, aes(x=Spp, y=percentile)) +
geom_hline(aes(yintercept=0), linetype="dashed", color="#000000") +
geom_hline(aes(yintercept=20), linetype="dashed", color="#0072B2") +
geom_hline(aes(yintercept=40), linetype="dashed", color="#56B4E9") +
geom_hline(aes(yintercept=60), linetype="dashed", color="#009E73") +
geom_hline(aes(yintercept=80), linetype="dashed", color="#E69F00") +
geom_boxplot(df, mapping = aes(fill=species))+
xlab("\nSpecies")+
ylab("Bat Activity Level (Percentile)\n")+
scale_fill_grey(start = 0.35, end = 1)+
scale_x_discrete(drop=TRUE) +
scale_y_continuous(breaks=seq(0,100,20)) +
expand_limits(y=c(0,100))+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(colour="black",
linetype="solid"),
axis.line=element_line(size=0.5, colour="black",
linetype="solid"),
axis.title.x=element_text(size=18),
axis.text.x  = element_text(angle=90, face="italic",
size=10, hjust=1, vjust=0),
axis.text.y  = element_text(size=12),
axis.line.x = element_line(color="black", size = 0.5),
axis.line.y = element_line(color="black", size = 0.5),
axis.title.y=element_text(size=16),
legend.position="none") +
facet_grid_paginate(Month ~ ., ncol=1, nrow=4,
scales="fixed", page=i) +
theme(strip.text.y = element_text(size=12, face="italic")))
}
n_pages_months <- ceiling(nrow(unique(df[,c("Month")]))/4)
#boxplot if 1 location
for (i in seq_len(n_pages_months)){
print(ggplot(df, aes(x=Spp, y=percentile)) +
geom_hline(aes(yintercept=0), linetype="dashed", color="#000000") +
geom_hline(aes(yintercept=20), linetype="dashed", color="#0072B2") +
geom_hline(aes(yintercept=40), linetype="dashed", color="#56B4E9") +
geom_hline(aes(yintercept=60), linetype="dashed", color="#009E73") +
geom_hline(aes(yintercept=80), linetype="dashed", color="#E69F00") +
geom_boxplot(df, mapping = aes(fill=species))+
xlab("\nSpecies")+
ylab("Bat Activity Level (Percentile)\n")+
scale_fill_grey(start = 0.35, end = 1)+
scale_x_discrete(drop=TRUE) +
scale_y_continuous(breaks=seq(0,100,20)) +
expand_limits(y=c(0,100))+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(colour="black",
linetype="solid"),
axis.line=element_line(size=0.5, colour="black",
linetype="solid"),
axis.title.x=element_text(size=18),
axis.text.x  = element_text(angle=90, face="italic",
size=10, hjust=1, vjust=0),
axis.text.y  = element_text(size=12),
axis.line.x = element_line(color="black", size = 0.5),
axis.line.y = element_line(color="black", size = 0.5),
axis.title.y=element_text(size=16),
legend.position="none") +
facet_grid_paginate(Month ~ ., ncol=1, nrow=4,
scales="fixed", page=i) +
theme(strip.text.y = element_text(size=12, face="italic")))
}
## Night ~ percentile graph if >5 location + >1 species
#if data spans more than a year
if((difftime(max(df$Night),min(df$Night), units='days')>300) & loc>5 & spn>1) {
for (i in seq_len(n_pages)) {
print(graph_baseplot(df, "12 weeks") +
facet_wrap_paginate(species ~ location_name, ncol=2, nrow=4,
scales="fixed", page=i) +
theme(strip.text.y = element_text(size=12, face="italic"),
strip.text.x = element_text(size=12)))
}
}
## baseplot for medians across all detectors
median_baseplot <- function (df, breaks) {
graph_medians <- ggplot(medians, aes(x = Night,
y = (median(med)))) +
geom_point(medians, size=3, shape=1,
mapping = aes(x=Night, y= med,
color=activity_level))+
ylab("\nMedian Bat Activity Level")+
scale_colour_manual(values=cbbPalette, name="Activity\nLevel",
breaks=c("High","Moderate/High","Moderate",
"Low/Moderate","Low"))+
scale_y_continuous(breaks=seq(0,100,20), limits=c(0,100)) +
scale_x_date(name = "\nDate", date_breaks = breaks,
date_labels = "%d %b %Y")+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(colour="black",
linetype="solid"),
axis.line=element_line(size=0.5, colour="black",
linetype="solid"),
axis.title.x=element_text(size=14),
axis.text.x  = element_text(angle=90,size=12,
hjust=1, vjust=0),
axis.text.y  = element_text(size=12),
axis.line.x = element_line(color="black", size = 0.5),
axis.line.y = element_line(color="black", size = 0.5),
axis.title.y=element_text(size=14)) +
geom_hline(aes(yintercept=20), linetype="dashed",
color="#0072B2") +
geom_hline(aes(yintercept=40), linetype="dashed",
color="#56B4E9") +
geom_hline(aes(yintercept=60), linetype="dashed",
color="#009E73") +
geom_hline(aes(yintercept=80), linetype="dashed",
color="#E69F00")
return(graph_medians)
}
## Night ~ med graph if 1 location, 1 species
#if less than 21 days
if((difftime(max(medians$Night),min(medians$Night), units='days')<=21) & locs=="1" & spn=="1"){
median_baseplot(medians, "3 days")
}
df$percentiles <- as.numeric(df$percentile)
