ys<-subset(wp, surv >= 5) #subset to only include species with more than 5 records per location
spn<-length(unique(ys$species)) #calculate how many species had more than 5 records per location
loc<-length(unique(ys$sref)) #calculate how many locations the new subsetted dataframe
lspecies<-(unique(ys$species)) #pull names of species from new subsetted dataframe
date2<-as.Date(ys$date,format="%d/%m/%Y") #for date graphs later, convert date column into date objects
if(is.na(date2)) {ys$date<-as.Date(ys$date)}
ys$date<-parse_date_time(ys$date,"ymd")
if(is.na(ys$date)) {ys$date<-parse_date_time(ys$date,"dmy")}
date2<-parse_date_time(date2, "ymd")
if(is.na(ys$date)) {ys$date<-date2}
ys$date<-as.Date(ys$date)
# calculate how many pages the dates graphs need splitting over by findng # how many unique combinations and dividing by 8 (the number of plots
# per page)
# for the dates graphs, when >1 loc & >1 spp
n_pages <- ceiling(nrow(unique(ys[,c("species", "location_name")]))/8)
# when 1 loc & >1 spp
n_pages1 <- ceiling(nrow(unique(ys[,c("species", "location_name")]))/5)
library(plyr)
actdata <- ddply(df, c("location_name", "species"), summarise,
Nights.high = sum(activity_level=="high"),
Nights.modhigh = sum(activity_level=="medium/high"),
Nights.mod = sum(activity_level=="medium"),
Nights.lowmod = sum(activity_level=="low/medium"),
Nights.low = sum(activity_level=="low"))
#rename columns
names(actdata)[names(actdata)=="location_name"] <- "Location"
names(actdata)[names(actdata)=="species"] <- "Species/Species Group"
names(actdata)[names(actdata)=="Nights.high"] <- "Nights of High Activity"
names(actdata)[names(actdata)=="Nights.modhigh"] <- "Nights of Moderate/ High Activity"
names(actdata)[names(actdata)=="Nights.mod"] <- "Nights of Moderate Activity"
names(actdata)[names(actdata)=="Nights.lowmod"] <- "Nights of Low/ Moderate Activity"
names(actdata)[names(actdata)=="Nights.low"] <- "Nights of Low Activity"
library(knitr)
results='asis'#important to run this as it ensures the raw table output isn't processed further by knitr
datatable2<-actdata
emphasize.italics.cols(2) #second column needs to be in italics i.e. species names
panderOptions("table.split.table", Inf) #don't split table
pander(datatable2, style = 'rmarkdown', keep.line.breaks=TRUE)
library(plyr)
library(rcompanion)
con<-subset(wp, surv>=2) #subset dataset to only include records with more than one night of surveying
confint<-groupwiseMedian(percentile ~ sref + species, #code to get confidence intervals
data       = con,
conf       = 0.95,
R          = 1000,
wilcox =   TRUE,
bca        = FALSE,
digits     = 3)
confint <- transform(confint, Wilcox.lower = ifelse(Wilcox.lower == "NaN", Median, Wilcox.lower))
confint <- transform(confint, Wilcox.upper = ifelse(Wilcox.upper == "NaN", Median, Wilcox.upper))
mm<-merge(con, confint) #merge with subsetted dataset to put columns with the confidence intervals on the end
mm$confint = paste(mm$Wilcox.lower, mm$Wilcox.upper, sep=" - ") #add a new column with CIs merged
non<-subset(wp,surv=="1") #subset dataset to only include records with one night of surveying
if(nrow(non)>0) {
non$n <- 0 #add empty columns to enable merger
non$Median <- 0
non$Wilcox.upper <- 0
non$Wilcox.lower <- 0
non$confint <- 0}
please<-rbind(mm, non) #join the two datasets back together
library(plyr) #ddply as normal
mdata2 <- ddply(please, c("location_name", "species"), summarise,
Median.percentile = ceiling(median(percentile)),#finds median percentile
conf = max(confint),
Highest.perc = max(percentile), #returns max percentiles
Number.nights = length(date), #returns how many nights of data in the dataset
Reference.range.size = mean(reference_range_size)) #returns reference range size - i used mean as it should be the
#same in each row because same species same location
names(mdata2)[names(mdata2)=="location_name"] <- "Location"
names(mdata2)[names(mdata2)=="species"] <- "Species/Species Group"
names(mdata2)[names(mdata2)=="Median.percentile"] <- "Median Percentile"
names(mdata2)[names(mdata2)=="conf"] <- "95% CIs"
names(mdata2)[names(mdata2)=="Highest.perc"] <- "Max Percentile"
names(mdata2)[names(mdata2)=="Number.nights"] <- "Nights Recorded"
names(mdata2)[names(mdata2)=="Reference.range.size"] <- "Reference Range"
library(knitr)
library(pander)
results='asis' #important to run this as it ensures the raw table output isn't processed further by knitr
medtable2<-mdata2
emphasize.italics.cols(2)
panderOptions("table.split.table", Inf)
panderOptions("table.split.cells", Inf)
pander(medtable2, style = 'multiline', keep.line.breaks=TRUE,justify = c('right', 'left', 'centre', 'centre', 'centre', 'centre', 'centre'))
#boxplot if 1 location
if(loc=="1") {graphbox<-ggplot(ys, aes(x=species, y=percentile))+ #add lines first
geom_hline(aes(yintercept=0), linetype="dashed", color="#000000") +
geom_hline(aes(yintercept=20), linetype="dashed", color="#0072B2") +
geom_hline(aes(yintercept=40), linetype="dashed", color="#56B4E9") +
geom_hline(aes(yintercept=60), linetype="dashed", color="#009E73") +
geom_hline(aes(yintercept=80), linetype="dashed", color="#E69F00") +
geom_boxplot(df, mapping = aes(fill=species))+
xlab("Species")+
ylab("Bat Activity Level (Percentile)")+
scale_colour_grey()+
scale_y_continuous(breaks=seq(0,100,20)) +
expand_limits(y=c(0,100))+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(linetype="blank"),
axis.line=element_line(size=0.5, colour="black", linetype="solid"),
axis.title.x=element_text(size=18),
axis.text.x  = element_text(angle=90, face="italic", size=16),
axis.text.y  = element_text(size=12),
axis.line.x = element_line(color="black", size = 0.5),
axis.line.y = element_line(color="black", size = 0.5),
axis.title.y=element_text(size=18),
legend.position="none")
graphbox}
#endcode for boxplot
runApp('//smbhome.uscs.susx.ac.uk/brs28/Desktop/MammalSociety/Ecobat/Ecobat/Shiny_Apps/App-2')
#boxplot if 1 location
if(loc=="1") {graphbox<-ggplot(ys, aes(x=species, y=percentile))+ #add lines first
geom_hline(aes(yintercept=0), linetype="dashed", color="#000000") +
geom_hline(aes(yintercept=20), linetype="dashed", color="#0072B2") +
geom_hline(aes(yintercept=40), linetype="dashed", color="#56B4E9") +
geom_hline(aes(yintercept=60), linetype="dashed", color="#009E73") +
geom_hline(aes(yintercept=80), linetype="dashed", color="#E69F00") +
geom_boxplot(df, mapping = aes(fill=species))+
xlab("Species")+
ylab("Bat Activity Level (Percentile)")+
scale_colour_grey()+
scale_y_continuous(breaks=seq(0,100,20)) +
expand_limits(y=c(0,100))+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(linetype="blank"),
axis.line=element_line(size=0.5, colour="black", linetype="solid"),
axis.title.x=element_text(size=18),
axis.text.x  = element_text(angle=90, face="italic", size=14, hjust=1, vjust=0),
axis.text.y  = element_text(size=12),
axis.line.x = element_line(color="black", size = 0.5),
axis.line.y = element_line(color="black", size = 0.5),
axis.title.y=element_text(size=18),
legend.position="none")
graphbox}
#endcode for boxplot
#boxplot if 1 location
if(loc=="1") {graphbox<-ggplot(ys, aes(x=species, y=percentile))+ #add lines first
geom_hline(aes(yintercept=0), linetype="dashed", color="#000000") +
geom_hline(aes(yintercept=20), linetype="dashed", color="#0072B2") +
geom_hline(aes(yintercept=40), linetype="dashed", color="#56B4E9") +
geom_hline(aes(yintercept=60), linetype="dashed", color="#009E73") +
geom_hline(aes(yintercept=80), linetype="dashed", color="#E69F00") +
geom_boxplot(df, mapping = aes(fill=species))+
xlab("Species")+
ylab("Bat Activity Level (Percentile)")+
scale_colour_grey()+
scale_y_continuous(breaks=seq(0,100,20)) +
expand_limits(y=c(0,100))+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(linetype="blank"),
axis.line=element_line(size=0.5, colour="black", linetype="solid"),
axis.title.x=element_text(size=18),
axis.text.x  = element_text(angle=90, face="italic", size=14, hjust=1, vjust=0),
axis.text.y  = element_text(size=12),
axis.line.x = element_line(color="black", size = 0.5),
axis.line.y = element_line(color="black", size = 0.5),
axis.title.y=element_text(size=16),
legend.position="none")
graphbox}
#endcode for boxplot
#boxplot if 1 location
if(loc=="1") {graphbox<-ggplot(ys, aes(x=species, y=percentile))+ #add lines first
geom_hline(aes(yintercept=0), linetype="dashed", color="#000000") +
geom_hline(aes(yintercept=20), linetype="dashed", color="#0072B2") +
geom_hline(aes(yintercept=40), linetype="dashed", color="#56B4E9") +
geom_hline(aes(yintercept=60), linetype="dashed", color="#009E73") +
geom_hline(aes(yintercept=80), linetype="dashed", color="#E69F00") +
geom_boxplot(df, mapping = aes(fill=species))+
xlab("Species")+
ylab("n/Bat Activity Level (Percentile)")+
scale_colour_grey()+
scale_y_continuous(breaks=seq(0,100,20)) +
expand_limits(y=c(0,100))+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(linetype="blank"),
axis.line=element_line(size=0.5, colour="black", linetype="solid"),
axis.title.x=element_text(size=18),
axis.text.x  = element_text(angle=90, face="italic", size=14, hjust=1, vjust=0),
axis.text.y  = element_text(size=12),
axis.line.x = element_line(color="black", size = 0.5),
axis.line.y = element_line(color="black", size = 0.5),
axis.title.y=element_text(size=16),
legend.position="none")
graphbox}
#endcode for boxplot
#boxplot if 1 location
if(loc=="1") {graphbox<-ggplot(ys, aes(x=species, y=percentile))+ #add lines first
geom_hline(aes(yintercept=0), linetype="dashed", color="#000000") +
geom_hline(aes(yintercept=20), linetype="dashed", color="#0072B2") +
geom_hline(aes(yintercept=40), linetype="dashed", color="#56B4E9") +
geom_hline(aes(yintercept=60), linetype="dashed", color="#009E73") +
geom_hline(aes(yintercept=80), linetype="dashed", color="#E69F00") +
geom_boxplot(df, mapping = aes(fill=species))+
xlab("Species")+
ylab("/nBat Activity Level (Percentile)")+
scale_colour_grey()+
scale_y_continuous(breaks=seq(0,100,20)) +
expand_limits(y=c(0,100))+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(linetype="blank"),
axis.line=element_line(size=0.5, colour="black", linetype="solid"),
axis.title.x=element_text(size=18),
axis.text.x  = element_text(angle=90, face="italic", size=14, hjust=1, vjust=0),
axis.text.y  = element_text(size=12),
axis.line.x = element_line(color="black", size = 0.5),
axis.line.y = element_line(color="black", size = 0.5),
axis.title.y=element_text(size=16),
legend.position="none")
graphbox}
#endcode for boxplot
#boxplot if 1 location
if(loc=="1") {graphbox<-ggplot(ys, aes(x=species, y=percentile))+ #add lines first
geom_hline(aes(yintercept=0), linetype="dashed", color="#000000") +
geom_hline(aes(yintercept=20), linetype="dashed", color="#0072B2") +
geom_hline(aes(yintercept=40), linetype="dashed", color="#56B4E9") +
geom_hline(aes(yintercept=60), linetype="dashed", color="#009E73") +
geom_hline(aes(yintercept=80), linetype="dashed", color="#E69F00") +
geom_boxplot(df, mapping = aes(fill=species))+
xlab("Species")+
ylab("Bat Activity Level (Percentile)")+
scale_colour_grey()+
scale_y_continuous(breaks=seq(0,100,20)) +
expand_limits(y=c(0,100))+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(linetype="blank"),
axis.line=element_line(size=0.5, colour="black", linetype="solid"),
axis.title.x=element_text(size=18),
axis.text.x  = element_text(angle=90, face="italic", size=14, hjust=1, vjust=0),
axis.text.y  = element_text(size=12),
axis.line.x = element_line(color="black", size = 0.5),
axis.line.y = element_line(color="black", size = 0.5),
axis.title.y=element_text(size=16),
legend.position="none")
graphbox}
#endcode for boxplot
runApp('//smbhome.uscs.susx.ac.uk/brs28/Desktop/MammalSociety/Ecobat/Ecobat/Shiny_Apps/App-2')
runApp('//smbhome.uscs.susx.ac.uk/brs28/Desktop/MammalSociety/Ecobat/Ecobat/Shiny_Apps/App-2')
runApp('//smbhome.uscs.susx.ac.uk/brs28/Desktop/MammalSociety/Ecobat/Ecobat/Shiny_Apps/App-2')
shiny::runApp('//smbhome.uscs.susx.ac.uk/brs28/Desktop/MammalSociety/Ecobat/Ecobat/Percentiles/App-2')
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message=FALSE, comment=NULL)
#Libraries used
library(tidyverse) # Enables a consistent approach to data science
library(dplyr)
library(suncalc) # Suntimes
library(knitr)
library(lubridate) # best package for working with dates and times
library(ggplot2)
library(ggforce) # needed for facet_wrap_paginate for plotting graphs on diff pages
library(pander)
library(reshape2) # used for wide/short data format conversions
library(png)
library(grid)
library(janitor) # used to add totals rows to bottoms of tables
library(RColorBrewer) # used for colourblind friendly colour scales on figures
# TESTING - load in test data
B_data <- read.csv("../Data/RiggedHill.csv")
# Standardize Variables - make names consistent for further manipulation; can do the same for other bat sound analysis software e.g. Kaleidoscope. Make time zone local e.g `"Europe/London"`; adjusts for daylight saving automatically.
# if there is a separate column for date and time then join together to form a new column called Timestamp
if (("Date" %in% colnames(B_data) == TRUE) &
("Time" %in% colnames(B_data) == TRUE)) {
B_data$Timestamp <- paste(B_data$Date, B_data$Time) }
#Make Time Zone Local
B_data$DateTime <- lubridate::dmy_hms(B_data$Timestamp, tz = "Europe/London")
# change any instances of spec. to spp. in the species column
#B_data$Species <- stringr::str_replace(B_data$Species, "spec.", "spp." )
B_data$SppDets <- paste(B_data$Species, B_data$Detector.ID, sep = ' : ')
# Create Useful Variables
# `Night` date at dusk
# `Month` month of observation `Jan, Feb, Mar....`
# `JustTime` time hh:mm of bat observation (12 hours added so plots correctly as `Night` i.e. dusk to dawn)
# `bat_time` time in seconds bat present see <https://rbats-blog.updog.co/2018/06/19/a-bat-time-metric/>
# if there is no information about the calls of the bats do this:
if ("Calls" %in% colnames(B_data) == FALSE)
{
B_data2 <- B_data %>%
mutate(Night = DateTime - lubridate::hours(12)) %>% # DateTime minus 12 hours
mutate(Night = lubridate::as_date(Night)) %>%
mutate(Month = lubridate::month(Night, label = T)) %>% # Make Month of observation
mutate(JustTime = DateTime + lubridate::hours(12)) %>%
mutate(JustTime = hms::as.hms(stringr::str_sub(as.character(JustTime), start = 12, end = 19))) %>%
#mutate(Bat_time = (Calls * (Length + Distance)) / 1000) %>%
#Remove NA observations
filter(!is.na(Species)) %>%
select(Night, JustTime, DateTime, Species, Month, Latitude, Longitude, Detector.ID, SppDets)
}
# if call info is provided, calculate 'Bat_time'
if ("Calls" %in% colnames(B_data) == TRUE)
{
B_data2 <- B_data %>%
mutate(Night = DateTime - lubridate::hours(12)) %>% # DateTime minus 12 hours
mutate(Night = lubridate::as_date(Night)) %>%
mutate(Month = lubridate::month(Night, label = T)) %>% # Make Month of observation
mutate(JustTime = DateTime + lubridate::hours(12)) %>%
mutate(JustTime = hms::as.hms(stringr::str_sub(as.character(JustTime), start = 12, end = 19))) %>%
mutate(Bat_time = (Calls * (Length + Distance)) / 1000) %>%
#Remove NA observations
filter(!is.na(Species)) %>%
select(Night, JustTime, DateTime, Species, Bat_time, Month, Latitude, Longitude, Detector.ID, SppDets)
}
# Change the format of the date from Y-m-d to d-m-Y:
# B_data2$Night2 <- as.Date(as.character(B_data2$Night, tz = "Europe/London", "%d/%m/%Y"), "%Y-%m-%d")
#
# B_data2$Night2 <- format(as.Date(B_data2$Night, format = "%Y-%m-%d"), format = "%d/%m/%Y")
#
# B_data2$Night3 <- as.Date(B_data2$Night2, format = "%d/%m/%Y")
#
# glimpse(B_data2)
#
# # B_data2$Night2 <- format(B_data2$Night, format=c("%d-%m-%Y"))
# # B_data2$Night2 <- as.Date(B_data2$Night, format=c("%d-%m-%Y"))
# Create suntimes
# Use package `suncalcs` to make `sunset` and `sunrise` columns for each `Night` and the location (`Latitude` and `Longitude`) of the bat survey.
# Get number nights between first and last bat observation (plus 1 for dawn)
num_nights <- as.integer(difftime(max(B_data2$Night) ,
min(B_data2$Night) ,
units = c("days"))) + 1
# Make a date vector of nights between first and last bat observation.
nightlist <- seq.Date(from=min(B_data2$Night),
length.out = num_nights +1,
by='days')
# Get suntimes for date vector and Location (Latitude and Longitude)
setdata <- getSunlightTimes(date = nightlist,
lat = median(B_data2$Latitude, na.rm = T),
lon = median(B_data2$Longitude, na.rm = T),
tz = "Europe/London")
# Duplicate data.frame to make sunrise data
risedata <- setdata
# Select  sunset date and time
setdata2 <- setdata %>%
select(date, sunset) %>%
mutate(date = lubridate::as_date(date))
# Select  sunrise date and time
risedata2 <- risedata %>%
select(date, sunrise) %>%
mutate(date = lubridate::as_date(date)) %>%
mutate(date = date - lubridate::days(1))
# Combine sunset and risedata by
sun_data <- dplyr::full_join(setdata2, risedata2, by="date")
# Rename date as Night
colnames(sun_data) <- c("Night", "sunset", "sunrise")
sun_data <- sun_data %>%
mutate(night_length_hr = as.numeric(difftime(sunrise, sunset, units='hours')),
night_length_min = as.numeric(difftime(sunrise, sunset, units='mins')))
# Join bat data with the sundata by Night
joined_data <- dplyr::left_join(B_data2, sun_data, by="Night")
#  ## Create Variables Relative to Suntimes and Bat Observation
#
#  Variables relative to suntimes and bat observation
#
# * `post_set_min` bat observation time minutes after sunset
#  * `pre_rise_min` bat observation time minutes before sunrise
#  * `post_set_hr` bat observation time hours after sunset
#  * `pre_rise_hr` bat observation time hours before sunrise
#  * `post_set_hr_int` bat observation time as an integer (hour) after sunset
#      + `-0.5` to `0.49` hours is `0` hour
#      + `0.5` to `1.49` hours is `1` hour
#      + `1.5` to `2.49` hours is `2` hour
#      + `2.5` to `3.49` hours is `3` hour ect...
#  * `pre_rise_hr_int` bat observation time as an integer (hour) before sunrise
#      + `-0.5` to `0.49` hours is `0` hour
#      + `0.5` to `1.49` hours is `1` hour
#      + `1.5` to `2.49` hours is `2` hour
#      + `2.5` to `3.49` hours is `3` hour ect...
#  * `night_length_hr`  length of the night in hours
# To make sure difference is in minutes/hours etc... use difftime
All_data <- joined_data %>%
mutate(post_set_min = as.numeric(difftime(DateTime, sunset, units='mins')),
pre_rise_min = as.numeric(difftime(sunrise, DateTime, units='mins')),
post_set_hr = as.numeric(difftime(DateTime, sunset, units='hours')),
pre_rise_hr = as.numeric(difftime(sunrise, DateTime, units='hours')),
post_set_hr_int = as.integer(round(post_set_hr, digits = 0)),
pre_rise_hr_int = as.integer(round(pre_rise_hr, digits = 0)))
#Russ(2012) Bat roost emergence times minutes after sunset
Species <- c("Barbastella barbastellus",
"Eptesicus serotinus",
"Myotis alcathoe",
"Myotis bechsteinii",
"Myotis brandtii",
"Myotis daubentonii",
"Myotis mystacinus",
"Myotis nattereri",
"Myotis spp.",
"Nyctalus leisleri",
"Nyctalus noctula",
"Nyctalus spp.",
"Pipistrellus nathusii",
"Pipistrellus pipistrellus",
"Pipistrellus pygmaeus",
"Pipistrellus spp.",
"Plecotus auritus",
"Plecotus austriacus",
"Rhinolophus ferrumequinum",
"Rhinolophus hipposideros")
Spp <- c("Barbastelle",
"Serotine",
"Alcathoe",
"Bechstein's",
"Brandt's",
"Daubenton's",
"Whiskered",
"Natterer's",
"Myotis spp.",
"Leisler's",
"Noctule",
"Nyctalus spp.",
"Nathusius'",
"Common pipistrelle",
"Soprano pipistrelle",
"Pipistrellus spp.",
"Brown long-eared",
"Grey long-eared",
"Greater horseshoe",
"Lesser horseshoe")
lower <- c(25, 20, 30, 30, 30, 50, 30, 35, 30, 8, 5, 5, 18, 22, 22, 18, 40, 40, 35, 35)
upper <- c(60, 25, 35, 33, 35, 70, 35, 55, 70, 18, 9, 18, 28, 32, 28, 32, 60, 60, 48, 50)
russ <- tibble(Species, Spp, lower, upper)
#Join with Jon Russ data with bat observation data All_data
All_data <- dplyr::left_join(All_data, russ, by = "Species")
# create lists to be used for tables and graphs later:
# list of all of the unique locations in the dataset
Dets <- c(unique(All_data$Detector.ID))
# list of all of the different species in the dataset
Species_list <- unique(All_data$Species)
Spp_list <- unique(All_data$Spp)
# list of all of the unique species-location combinations
SpDet <- c(unique(All_data$SppDets))
# dataframe of survey days
Surv.days <- as.data.frame(unique(All_data$Night)) #all unique survey nights
Surv.days.N <- length(Surv.days$`unique(All_data$Night)`) #count of survey nights
Surv.days.M <- Surv.days %>%
mutate(Month = lubridate::month((unique(All_data$Night)), label = T)) %>%
count(Month) #count of survey days per month
colourCount <- length(unique(All_data$Spp))
getPalette <- colorRampPalette(brewer.pal(9, "RdBu"))
All_data$Spp <- factor(All_data$Spp,levels=c("Pipistrellus spp.", "Common pipistrelle", "Soprano pipistrelle","Nathusius'", "Nyctalus spp.","Noctule", "Leisler's","Serotine", "Brown long-eared", "Grey long-eared", "Myotis spp.","Alcathoe", "Bechstein's",  "Brandt's", "Daubenton's","Whiskered", "Natterer's", "Barbastelle", "Greater horseshoe", "Lesser horseshoe"))
Table <- All_data %>%
group_by(Spp, Detector.ID, post_set_hr_int) %>%
count() %>%
spread(post_set_hr_int, n) %>%
replace(is.na(.), 0)
Table2 <- melt(Table)
Table3 <- Table2 %>%
rename(ss_hr = variable, Passes = value) %>%
arrange(Spp, Detector.ID, ss_hr) %>%
group_by(Spp, Detector.ID) %>%
mutate(cs = cumsum(Passes))
for (i in (unique(All_data$Spp))) {
print(Table3 %>%
filter(Spp == i) %>%
ggplot(aes(x = ss_hr, y = cs, group =1)) +
geom_point() +
geom_line() +
xlab("\nHours after Sunset") +
ylab("Total number of passes\n") +
scale_color_brewer(palette = "RdBu") +
theme_bw() +
theme (axis.title.y = element_text(colour="black", size=22,
face="bold")) +
theme (axis.title.x = element_text(colour="black", size=22,
face="bold")) +
theme(strip.text.x = element_text(size=22, face="bold")) +
theme(axis.text.x = element_text(size=20, colour = "black")) +
theme(axis.text.y = element_text(size = 20, colour = "black")) +
facet_wrap(~Detector.ID) +
ggtitle(i) +
theme(plot.title = element_text(face = "bold.italic", size = 22))
)
}
for (i in unique(All_data$Spp)) {
print(All_data %>%
filter(Spp == i) %>%
ggplot(aes(Night, post_set_min)) +
stat_density2d(aes(alpha = ..level.., fill =..level..), geom="polygon") +
# geom_density2d() +
scale_fill_gradient(low = "yellow", high = "red") +
geom_point(size=2, alpha = 0.5) +
geom_line(data = sun_data, aes(Night, night_length_min),
linetype = "dashed", colour = "red") +
xlab("\nDate") +
ylab("Minutes after sunset\n") +
#scale_x_date(date_breaks = "1 month", date_labels = "%b %d") +
theme_bw() +
theme (legend.position = "none") +
theme (axis.title.y = element_text(colour="black", size=18,
face="bold")) +
theme (axis.title.x = element_text(colour="black", size=18,
face="bold")) +
theme(strip.text.x = element_text(size=18, face="bold")) +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(colour="black", linetype="solid"),
axis.line=element_line(size=0.5, colour="black",
linetype="solid")) +
theme(axis.text.x = element_text(angle=90, size=16, hjust=1, vjust=0.5,
colour = "black")) +
theme(axis.text.y = element_text(size = 16, colour = "black")) +
facet_wrap(Detector.ID~.) +
ggtitle(i) +
theme(plot.title = element_text(face = "bold.italic", size = 18)))
}
#position = position_jitter(w = 1, h = 0)) +
